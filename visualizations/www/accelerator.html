<!DOCTYPE html>
<head>
	<title>Accelerator Visualization</title>
</head>
<style>

html, body {
	font: 11px "Helvetica Neue", Helvetica, Arial, sans-serif;
}

circle {
	fill: black;
}
.axis {
	fill: none;
	stroke: black;
}

#arrow {
	 stroke: black;
	 stroke-width: 5;
}

.linetitle {
	font-weight: bold;
}
</style>

<script src="http://d3js.org/d3.v4.min.js"></script>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

<script>
	var socket = io.connect('http://localhost:8080');
	// ping and pong are reserved events, hence we use myping and mypong
	socket.on('myping', function () {
		console.log('Client got PING!');
		socket.emit('mypong');
	});
	socket.on('measurement', function (data) {
		console.log('Got measurement', data);
		d3.select('#arrow')
			.attr('x2', data.x*200)
			.attr('y2', data.y*200);
	});
	socket.on('currentcommand', function (data) {
		d3.select('#currentcommand').text(data.cmd);
	});

	// Just a sample complex object to show off what kind of data structures
	// can be sent over the sockets
	var complexDataObject = {
		propOne: 'here we have a string',
		arrSample: [0, 2, 3],
		nestedObject: {
			valOne: 8,
			obj: { test: '3' }
		}
	};
	function sendCommand() {
		if(socket) {
			var val = document.getElementById('cmd').value;
			complexDataObject.commandValue = val;
			
			console.log('Sending event to server: ', complexDataObject);
			socket.emit('command', complexDataObject);
		}
	}
</script>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 220">
	<marker id="triangle" viewBox="0 0 10 10" refX="0" refY="5" markerUnits="strokeWidth" markerWidth="4" markerHeight="3" orient="auto">
		<path d="M 0 0 L 10 5 L 0 10 z"/>
	</marker>

	<!-- the axis lines through the circle -->

	<!-- the circle needs a bit shifting to left down by 10 pixel each -->
	<g transform="translate(10, 10)">
		<line class="axis" x1="-10" y1="100" x2="210" y2="100" />
		<line class="axis" x1="100" y1="-10" x2="100" y2="210" />
		<text x="210" y="110">x</text>
		<text x="105" y="-5">y</text>
		<!-- the circle around the axis -->
		<circle class="axis" cx="100" cy="100" r="100"></circle>
		
		<!-- the actual arrow -->
		<line id="arrow" x1="100" y1="100" x2="200" y2="15" marker-end="url(#triangle)" />
		
		<!-- a little dot in the middle of the circle -->
		<circle cx="100" cy="100" r="5"></circle>
	</g>
</svg>
<table>
	<tr>
		<td class="linetitle">Command to send to server: </td>
		<td>
			<input type="text" id="cmd" />
			<button onclick="sendCommand()">send</button>
		</td>
	</tr>
	<tr>
		<td class="linetitle">Command received from server: </td>
		<td id="currentcommand"></td>
	</tr>
</table>
